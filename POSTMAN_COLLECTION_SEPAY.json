{
  "info": {
    "name": "HaiAnhTeeth - Payment with Sepay",
    "_postman_id": "sepay-payment-collection",
    "description": "Collection để test payment flow với Sepay",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. Login",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"123456\"\n}"
        },
        "url": {
          "raw": "{{BASE_URL}}/api/auth/login",
          "host": ["{{BASE_URL}}"],
          "path": ["api", "auth", "login"]
        }
      },
      "response": []
    },
    {
      "name": "2. Đặt lịch TƯ VẤN (có thanh toán)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{JWT_TOKEN}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"phoneNumber\": \"0123456789\",\n  \"appointmentFor\": \"self\",\n  \"serviceId\": \"68f6203696c4fb9fde3d6677\",\n  \"doctorUserId\": \"YOUR_DOCTOR_USER_ID\",\n  \"doctorScheduleId\": \"YOUR_SCHEDULE_ID\",\n  \"selectedSlot\": {\n    \"startTime\": \"2025-10-25T09:00:00.000Z\",\n    \"endTime\": \"2025-10-25T09:30:00.000Z\"\n  },\n  \"notes\": \"Tôi muốn tư vấn về niềng răng\"\n}"
        },
        "url": {
          "raw": "{{BASE_URL}}/api/appointments/consultation/create",
          "host": ["{{BASE_URL}}"],
          "path": ["api", "appointments", "consultation", "create"]
        }
      },
      "response": []
    },
    {
      "name": "3. Check Payment Status",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{JWT_TOKEN}}"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/payments/{{PAYMENT_ID}}/check",
          "host": ["{{BASE_URL}}"],
          "path": ["api", "payments", "{{PAYMENT_ID}}", "check"]
        }
      },
      "response": []
    },
    {
      "name": "4. Get Payment Info",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{JWT_TOKEN}}"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/payments/{{PAYMENT_ID}}",
          "host": ["{{BASE_URL}}"],
          "path": ["api", "payments", "{{PAYMENT_ID}}"]
        }
      },
      "response": []
    },
    {
      "name": "5. Manual Confirm Payment (Admin)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{ADMIN_JWT_TOKEN}}"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{BASE_URL}}/api/payments/{{PAYMENT_ID}}/confirm",
          "host": ["{{BASE_URL}}"],
          "path": ["api", "payments", "{{PAYMENT_ID}}", "confirm"]
        }
      },
      "response": []
    },
    {
      "name": "6. Webhook Sepay (Simulate)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"id\": \"123456\",\n  \"gateway_transaction_id\": \"TXN123456\",\n  \"account_number\": \"0123456789\",\n  \"amount_in\": 100000,\n  \"transaction_content\": \"APPOINTMENT 12AB34CD\",\n  \"transaction_date\": \"2025-10-25T09:05:00.000Z\",\n  \"reference_number\": \"REF123\",\n  \"bank_account\": \"NGUYEN VAN A\"\n}"
        },
        "url": {
          "raw": "{{BASE_URL}}/api/payments/webhook/sepay",
          "host": ["{{BASE_URL}}"],
          "path": ["api", "payments", "webhook", "sepay"]
        }
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "BASE_URL",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "JWT_TOKEN",
      "value": "your_jwt_token_here",
      "type": "string"
    },
    {
      "key": "ADMIN_JWT_TOKEN",
      "value": "admin_jwt_token_here",
      "type": "string"
    },
    {
      "key": "PAYMENT_ID",
      "value": "payment_id_from_step_2",
      "type": "string"
    }
  ]
}

